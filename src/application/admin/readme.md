All these modules and function here need to be moved to services.